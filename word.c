#include "word.h"
#include "lcd.h"
#include <stdio.h>

unsigned char word[14][16*16/8] = 
	{
		{
/*--  文字:  0  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=9x16   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x16  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x1C,0x00,0x36,0x00,0x63,0x00,0x63,0x00,0x63,0x00,
0x63,0x00,0x63,0x00,0x63,0x00,0x63,0x00,0x36,0x00,0x1C,0x00,0x00,0x00,0x00,0x00,
		},
		{
/*--  文字:  1  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=9x16   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x16  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x0C,0x00,0x3C,0x00,0x0C,0x00,0x0C,0x00,0x0C,0x00,
0x0C,0x00,0x0C,0x00,0x0C,0x00,0x0C,0x00,0x0C,0x00,0x3F,0x00,0x00,0x00,0x00,0x00,
		},
		{
/*--  文字:  2  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=9x16   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x16  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x3E,0x00,0x63,0x00,0x63,0x00,0x63,0x00,0x03,0x00,
0x06,0x00,0x0C,0x00,0x18,0x00,0x30,0x00,0x63,0x00,0x7F,0x00,0x00,0x00,0x00,0x00,
		},
		{
/*--  文字:  3  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=9x16   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x16  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x3E,0x00,0x63,0x00,0x63,0x00,0x03,0x00,0x06,0x00,
0x1C,0x00,0x06,0x00,0x03,0x00,0x63,0x00,0x63,0x00,0x3E,0x00,0x00,0x00,0x00,0x00,
		},
		{
/*--  文字:  4  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=9x16   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x16  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x00,0x0E,0x00,0x0E,0x00,0x1E,0x00,0x36,0x00,
0x36,0x00,0x66,0x00,0x7F,0x80,0x06,0x00,0x06,0x00,0x1F,0x80,0x00,0x00,0x00,0x00,
		},
		{
/*--  文字:  5  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=9x16   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x16  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0x00,0x60,0x00,0x60,0x00,0x60,0x00,0x7C,0x00,
0x66,0x00,0x03,0x00,0x03,0x00,0x63,0x00,0x66,0x00,0x3C,0x00,0x00,0x00,0x00,0x00,
		},
		{
/*--  文字:  6  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=9x16   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x16  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x1C,0x00,0x36,0x00,0x60,0x00,0x60,0x00,0x7E,0x00,
0x73,0x00,0x63,0x00,0x63,0x00,0x63,0x00,0x33,0x00,0x1E,0x00,0x00,0x00,0x00,0x00,
		},
		{
/*--  文字:  7  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=9x16   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x16  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0x00,0x63,0x00,0x06,0x00,0x06,0x00,0x0C,0x00,
0x0C,0x00,0x18,0x00,0x18,0x00,0x18,0x00,0x18,0x00,0x18,0x00,0x00,0x00,0x00,0x00,
		},
		{
/*--  文字:  8  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=9x16   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x16  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x3E,0x00,0x63,0x00,0x63,0x00,0x63,0x00,0x36,0x00,
0x1C,0x00,0x36,0x00,0x63,0x00,0x63,0x00,0x63,0x00,0x3E,0x00,0x00,0x00,0x00,0x00,
		},
		{
/*--  文字:  9  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=9x16   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x16  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x00,0x66,0x00,0x63,0x00,0x63,0x00,0x63,0x00,
0x67,0x00,0x3F,0x00,0x03,0x00,0x03,0x00,0x36,0x00,0x1C,0x00,0x00,0x00,0x00,0x00,
		},
		{
/*--  文字:  °  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=9x16   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x16  --*/
0x00,0x00,0x1C,0x00,0x36,0x00,0x36,0x00,0x1C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		},
		{
/*--  文字:  C  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=9x16   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x16  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0x00,0x63,0x00,0x63,0x00,0xC0,0x00,0xC0,0x00,
0xC0,0x00,0xC0,0x00,0xC0,0x00,0x63,0x00,0x66,0x00,0x3C,0x00,0x00,0x00,0x00,0x00,
		},
		{
/*--  文字:  -  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=9x16   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x16  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		},
		{
/*--  文字:  .  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=9x16   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x16  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x00,0x70,0x00,0x00,0x00,0x00,0x00,
		},
	};


/*
	:用户指定在开发板的合适位置显示一个字符。
	@x0,y0:用户指定的显示位置。
	@word[]:用户指定显示的字符
	@w,h:显示字符的大小。
		字符大小取决于取模的字体大小，就是宽度和高度
*/
void word_display(char word[],int x0,int y0,int w,int h)
{
	//1.找到该像素点的显示位置
	int dian; //表示当前判断的这个像素点
	for(dian = 0;dian < w * h;dian++)
	{
		//要在屏幕上合适的位置显示这个像素点
		
		int x,y;//这个dian像素点，在屏幕上的显示位置
		
		//dian这个像素点在原始字符的第 dian / w行
		y = y0 + dian / w;
		
		//dian这个像素点在原始字符的第 dian % w列
		x = x0 + dian % w;
		
		//dian这个像素点是否在字符上。
		//判断依据:取模之后对应的那一个bit位是1还是0
		int index = dian / 8;	//求出当前像素点在取模数据中的第几个元素中
		
		//word[index]这个元素一共有8个bit位，当前dian对应的是哪一位？
		int bit = 7 - dian % 8;
		
		int color;//当前像素点要显示的颜色
		
		if(word[index] & (1<<bit))
		{
			//当前像素点在字符上，对应bit位为1
			color = 0xffffff;
		}
		else
		{
			color = 0x2E5479;
		}
		display_point(x,y,color);
	}
}

void show_tem(double temperature, int center_x, int center_y)
{
    int w = 16;      // 字模宽
    int h = 16;      // 字模高
    int spacing = 4; // 字符间距
    int x, y;

    // 1️⃣ 判断负号
    int is_negative = 0;
    if (temperature < 0) {
        is_negative = 1;
        temperature = -temperature;
    }

    // 2️⃣ 分离整数和小数部分（保留两位）
    int integer = (int)temperature;
    double frac = temperature - integer;
    int decimal = (int)(frac * 100); // 四舍五入两位

    // 🔸 防止小数进位溢出，例如 99.995 → 100.00
    if (decimal >= 100) {
        integer += 1;
        decimal = 0;
    }

    // 3️⃣ 处理整数部分字符串
    char buf_int[10];
    sprintf(buf_int, "%d", integer);
    int num_len = 0;
    for (int i = 0; buf_int[i] != '\0'; i++) num_len++;

    // 4️⃣ 处理小数部分两位
    char buf_dec[3];
    sprintf(buf_dec, "%02d", decimal); // 确保两位

    // 5️⃣ 总字符数 = 负号 + 整数 + 小数点 + 小数两位
    int char_count = num_len + 1 + 2 + (is_negative ? 1 : 0);

    // 6️⃣ 计算居中起始坐标
    int total_width = char_count * w + (char_count - 1) * spacing;
    int x0 = center_x - total_width / 2;
    int y0 = center_y - h / 2;

    x = x0;
    y = y0;

    // 7️⃣ 显示负号
    if (is_negative) {
        word_display(word[12], x, y, w, h);
        x += w + spacing;
    }

    // 8️⃣ 显示整数部分
    for (int i = 0; buf_int[i] != '\0'; i++) {
        int num = buf_int[i] - '0';
        word_display(word[num], x, y, w, h);
        x += w + spacing;
    }

    // 9️⃣ 显示小数点
    word_display(word[13], x, y, w, h);
    x += w + spacing;

    // 🔟 显示两位小数
    for (int i = 0; i < 2; i++) {
        int num = buf_dec[i] - '0';
        word_display(word[num], x, y, w, h);
        x += w + spacing;
    }
}
